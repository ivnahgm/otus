# Вебинар 4. Bash, awk, sed, grep и другие

## Домашнее задание

Пишем скрипт
подготовить свои скрипты для решения следующих кейсов:

1. watchdog с перезагрузкой процесса/сервиса
2. watchdog с отсылкой емэйла
3. анализ логов веб сервера/security лога - (на взлом/скорость ответа/выявление быстрых - медленных запросов, анализ IP адресов и кол-ва запросов от них)
4. крон скрипт с защитой от мультизапуска
5. любой скрипт на ваше усмотрение

желательно чтобы в скрипте были:
- циклы
- условия
- регекспы
- awk
- наличие в скрипте трапов и функций

## Решение

Решение состоит и 3 скриптов. Стенд собирается с помощью [Vagrantfile](Vagrantfile):

1. [query_script.sh](query_script.sh) запускается через cron каждую минуту.
curl совершает 1000 запросов к адресу http://127.0.0.1 с различными User-agent
(в скрипте используются 5 вариантов). Используется защита от мультизапуска.

2. [watchdog.sh](watchdog.sh) запускает/перезапускает заданный скрипт.
Обрабатывает сигналы с помощью trap.

3. [analize_access_log.sh](analize_access_log.sh) раз в минуту обрабатывает лог httpd
и высылает статистику по User-agent на почту.

Решение полностью используется в виртуальном окружении.

Письма можно смотреть в /var/spool/mail/root.

Запуск wathcdog.sh и analize_access_log.sh:
```
    $ sudo /vagrant/watchdog.sh "/vagrant/analize_access_log.sh /var/log/httpd/access_log"
```
